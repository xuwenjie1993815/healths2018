{include file="../application/admin/view/Public/_header.html"/}
<div class="page-container">
	<div class="row cl" style="width: 50%;float: left;">
        <label class="form-label col-xs-4 col-sm-2">高血压病龄:</label>
        <div class="formControls col-xs-8 col-sm-9">
            <input type="text" class="input-text" value="{$medical_history_info.diseaseMapper.bloodYear}" placeholder="" id="bloodYear" name="bloodYear">
        </div>
    </div>
    <div class="row cl" style="width: 50%;float: left;">
        <label class="form-label col-xs-4 col-sm-2">既往收缩压:</label>
        <div class="formControls col-xs-8 col-sm-9">
            <input type="text" class="input-text" value="{$medical_history_info.diseaseMapper.systolicBloodPressure}" placeholder="" id="systolicBloodPressure" name="systolicBloodPressure">
        </div>
    </div>
    <div class="row cl" style="width: 50%">
        <label class="form-label col-xs-4 col-sm-2">既往舒张压:</label>
        <div class="formControls col-xs-8 col-sm-9">
            <input type="text" class="input-text" value="{$medical_history_info.diseaseMapper.diastolicBloodPressure}" placeholder="" id="diastolicBloodPressure" name="diastolicBloodPressure">
        </div>
    </div>
	<div>
		<dl class="permission-list">
			<dt>
				<label>
					伴随临床疾患
				</label>
			</dt>
			<table class="table table-border table-bordered">
				<tr>
					<td id="isDiabetes" onClick="factor('isDiabetes')" {if condition="$medical_history_info.diseaseMapper.isDiabetes eq 1"} style="background-color:#C0C0C0" {/if}>糖尿病</td>
					<td id="cerebralVascularDisease" onClick="factor('cerebralVascularDisease')"  {if condition="$medical_history_info.diseaseMapper.cerebralVascularDisease eq 1"} style="background-color:#C0C0C0" {/if}>脑血管病</td>
					<td id="heartDisease" onClick="factor('heartDisease')" {if condition="$medical_history_info.diseaseMapper.heartDisease eq 1"} style="background-color:#C0C0C0" {/if}>心脏疾病</td>
					<td id="kidneyDisease" onClick="factor('kidneyDisease')" {if condition="$medical_history_info.diseaseMapper.kidneyDisease eq 1"} style="background-color:#C0C0C0" {/if}>肾脏疾病</td>
					<td id="peripheralAngiopathy" onClick="factor('peripheralAngiopathy')" {if condition="$medical_history_info.diseaseMapper.peripheralAngiopathy eq 1"} style="background-color:#C0C0C0" {/if}>周围血管病</td>
					<td id="retinopathy" onClick="factor('retinopathy')" {if condition="$medical_history_info.diseaseMapper.retinopathy eq 1"} style="background-color:#C0C0C0" {/if}>视网膜病变</td>
				</tr>
			</table>
		</dl>
		<dl class="permission-list">
			<dt>
				<label>
					心血管危险因素
				</label>
			</dt>
			<table class="table table-border table-bordered">
				<tr>
					<td id="isSmoke" onClick="factor('isSmoke')" {if condition="$medical_history_info.diseaseMapper.isSmoke eq 1"} style="background-color:#C0C0C0" {/if}>吸烟</td>
					<td id="bloodFat" onClick="factor('bloodFat')" {if condition="$medical_history_info.diseaseMapper.bloodFat eq 1"} style="background-color:#C0C0C0" {/if}>血脂异常</td>
					<td id="familyHypertension" onClick="factor('familyHypertension')" {if condition="$medical_history_info.diseaseMapper.familyHypertension eq 1"} style="background-color:#C0C0C0" {/if}>早发心血管病家族史</td>
					<td id="bellyObesity" onClick="factor('bellyObesity')" {if condition="$medical_history_info.diseaseMapper.bellyObesity eq 1"} style="background-color:#C0C0C0" {/if}>腹型肥胖</td>
				</tr>
			</table>
		</dl>
		<dl class="permission-list">
			<dt>
				<label>
					靶器官损害
				</label>
			</dt>
			<table class="table table-border table-bordered">
				<tr>
					<td id="leftVentricularHypertrophy" onClick="factor('leftVentricularHypertrophy')" {if condition="$medical_history_info.diseaseMapper.leftVentricularHypertrophy eq 1"} style="background-color:#C0C0C0" {/if}>左心室肥厚</td>
					<td id="iMT" onClick="factor('iMT')" {if condition="$medical_history_info.diseaseMapper.iMT eq 1"} style="background-color:#C0C0C0" {/if}>IMT>=0.9mm或动脉粥样硬化斑块</td>
					<td id="pWV" onClick="factor('pWV')" {if condition="$medical_history_info.diseaseMapper.pWV eq 1"} style="background-color:#C0C0C0" {/if}>颈股动脉PWV>=12m/s</td>
				</tr>
				<tr>
					<td id="aBI" onClick="factor('aBI')" {if condition="$medical_history_info.diseaseMapper.aBI eq 1"} style="background-color:#C0C0C0" {/if}>ABI<'0.9'</td>
					<td id="eGFR" onClick="factor('eGFR')" {if condition="$medical_history_info.diseaseMapper.eGFR eq 1"} style="background-color:#C0C0C0" {/if}>eGFR异常</td>
					<td id="albumin" onClick="factor('albumin')" {if condition="$medical_history_info.diseaseMapper.albumin eq 1"} style="background-color:#C0C0C0" {/if}>尿微量白蛋白30~300mg/24h或白蛋白/肌酐>=30mg/g</td>
				</tr>
			</table>
		</dl>
	</div>
</div>
<input type="hidden" name="data" id="data"  value={$history_data}>

<div class="row cl">
	<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
		<input class="btn btn-primary radius" type="submit" id="tijiao" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
	</div>
</div>
{include file="../application/admin/view/Public/_footer.html"/}
<script type="text/javascript">
$(function(){
	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
});

function factor(name) {
	var data = $("#data").val();
	var data_arr = data.split(',');
	var aa = 0;
	for(var i=0;i<data_arr.length;i++){
		if (data_arr[i] == name) {
			$('#'+name).css({'background-color':''});
			data_arr.splice(jQuery.inArray(name,data_arr),1);
			aa += 1;
		}
		if (aa>0) {
			data_new = data_arr.join(',');
			$("#data").val(data_new);
			return;
		}
	}
	$('#'+name).css({'background-color':'#C0C0C0'});
	if (data) {
		$("#data").val(data+','+name);
	}else{
		$("#data").val(name);
	}
}

$("#tijiao").click(function() {
	var data = $('#data').val();
	var bloodYear = $("#bloodYear").val();
	var systolicBloodPressure = $("#systolicBloodPressure").val();
	var diastolicBloodPressure = $("#diastolicBloodPressure").val();
  	$.ajax({
        url:"{:url('Admin/patient/patient_factor_add')}",
        type:'post',
        dataType:'json',
        data:{data:data,id:{$id},bloodYear:bloodYear,systolicBloodPressure:systolicBloodPressure,diastolicBloodPressure:diastolicBloodPressure},
        success:function(data){
            if(data.code==1){
            	layer.msg('操作成功,请稍等...',{icon:1,time:1000},function() {
                   parent.location.reload();
                })
            }else{
                layer.msg(data.msg,{icon:2,time:500});
            }
        }
    });
})

// $(document).keyup(function(event){
//   if(event.keyCode ==13){
//   	var data = $('#data').val();
//   	$.ajax({
//         url:"{:url('Admin/patient/patient_factor_add')}",
//         type:'post',
//         dataType:'json',
//         data:{data:data,id:{$id}},
//         success:function(data){
//             if(data.code==1){
//             	layer.msg('操作成功,请稍等...',{icon:1,time:1000},function() {
//                     location.reload();
//                 })
//             }else{
//                 layer.msg(data.msg);
//             }
//         }
//     });
//   }
// });
</script>