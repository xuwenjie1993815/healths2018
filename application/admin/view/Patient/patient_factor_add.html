{include file="../application/admin/view/Public/_header.html"/}
<div class="page-container">
	<div>
		<dl class="permission-list">
			<dt>
				<label>
					伴随临床疾患
				</label>
			</dt>
			<table class="table table-border table-bordered">
				<tr>
					<td id="diabetes" onClick="factor('diabetes')">糖尿病</td>
					<td id="cerebral_vascular_disease" onClick="factor('cerebral_vascular_disease')">脑血管病</td>
					<td id="heart_disease" onClick="factor('heart_disease')">心脏疾病</td>
					<td id="kidney_disease" onClick="factor('kidney_disease')">肾脏疾病</td>
					<td id="peripheral_angiopathy" onClick="factor('peripheral_angiopathy')">周围血管病</td>
					<td id="retinopathy" onClick="factor('retinopathy')">视网膜病变</td>
				</tr>
			</table>
		</dl>
		<dl class="permission-list">
			<dt>
				<label>
					心血管危险因素
				</label>
			</dt>
			<table class="table table-border table-bordered">
				<tr>
					<td id="smoke" onClick="factor('smoke')">吸烟</td>
					<td id="blood_fat" onClick="factor('blood_fat')">血脂异常</td>
					<td id="family_hypertension" onClick="factor('family_hypertension')">早发心血管病家族史</td>
					<td id="belly_obesity" onClick="factor('belly_obesity')">腹型肥胖</td>
				</tr>
			</table>
		</dl>
		<dl class="permission-list">
			<dt>
				<label>
					靶器官损害
				</label>
			</dt>
			<table class="table table-border table-bordered">
				<tr>
					<td id="left_ventricular_hypertrophy" onClick="factor('left_ventricular_hypertrophy')">左心室肥厚</td>
					<td id="IMT" onClick="factor('IMT')">IMT>=0.9mm或动脉粥样硬化斑块</td>
					<td id="PWV" onClick="factor('PWV')">颈股动脉PWV>=12m/s</td>
				</tr>
				<tr>
					<td id="ABI" onClick="factor('ABI')">ABI<'0.9'</td>
					<td id="eGFR" onClick="factor('eGFR')">eGFR异常</td>
					<td id="albumin" onClick="factor('albumin')">尿微量白蛋白30~300mg/24h或白蛋白/肌酐>=30mg/g</td>
				</tr>
			</table>
		</dl>
	</div>
</div>
<input type="hidden" name="data" id="data"  value=''>

<div class="row cl">
	<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
		<input class="btn btn-primary radius" type="submit" id="tijiao" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
	</div>
</div>
{include file="../application/admin/view/Public/_footer.html"/}
<script type="text/javascript">
$(function(){
	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
});

function factor(name) {
	var data = $("#data").val();
	var data_arr = data.split(',');
	var aa = 0;
	for(var i=0;i<data_arr.length;i++){
		if (data_arr[i] == name) {
			$('#'+name).css({'background-color':''});
			data_arr.splice(jQuery.inArray(name,data_arr),1);
			aa += 1;
		}
		if (aa>0) {
			data_new = data_arr.join(',');
			$("#data").val(data_new);
			return;
		}
	}
	$('#'+name).css({'background-color':'#C0C0C0'});
	if (data) {
		$("#data").val(data+','+name);
	}else{
		$("#data").val(name);
	}
}

$("#tijiao").click(function() {
	var data = $('#data').val();
  	$.ajax({
        url:"{:url('Admin/patient/patient_factor_add')}",
        type:'post',
        dataType:'json',
        data:{data:data,id:{$id}},
        success:function(data){
            if(data.code==1){
            	layer.msg('操作成功,请稍等...',{icon:1,time:1000},function() {
                    location.reload();
                })
            }else{
                layer.msg(data.msg);
            }
        }
    });
})

$(document).keyup(function(event){
  if(event.keyCode ==13){
  	var data = $('#data').val();
  	$.ajax({
        url:"{:url('Admin/patient/patient_factor_add')}",
        type:'post',
        dataType:'json',
        data:{data:data,id:{$id}},
        success:function(data){
            if(data.code==1){
            	layer.msg('操作成功,请稍等...',{icon:1,time:1000},function() {
                    location.reload();
                })
            }else{
                layer.msg(data.msg);
            }
        }
    });
  }
});
</script>